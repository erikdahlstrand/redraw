{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap eec79dcf89b8eb1c88c3","webpack:///./src/js/redraw.js","webpack:///./src/js/browser-api.js","webpack:///./src/js/canvas-wrapper.js","webpack:///./src/js/canvas-const.js","webpack:///./src/js/event-aggregator.js","webpack:///./src/js/controls/controls-dispatcher.js"],"names":["redrawNs","tools","dataURItoBlob","encodedData","decodedData","atob","split","array","i","length","push","charCodeAt","Blob","Uint8Array","type","getToolsFromUserSettings","allTools","options","definedTools","t","toolName","globalOverrides","overwriteProps","allProps","precedenceProps","globalOptions","results","p","hasOwnProperty","indexOf","Redraw","imgElement","events","_canvas","jsonContent","loadFromJSON","controls","initializeTools","canvas","deactivateAllWithDispatch","toDataURL","format","multiplier","scale","getDataUrlForExport","includeImage","cancelActiveTool","jsObj","toObject","backgroundImage","JSON","stringify","jsonRepresentation","getAllObjects","topic","callbackFn","subscriberId","scope","subscribeTo","unsubscribeTo","localToolSettings","toolSettings","toolsInUse","passedProps","toolFn","setupTools","canvasContainer","Annotation","registerTool","_name","_toolFn","_options","address","buttonClass","appendToWindow","isBrowser","window","Browser","document","attributeName","obj","getFromWindow","scrollPosition","elem","left","top","scrollLeft","scrollTop","offsetParent","Canvas","eventAggregator","parent","parentNode","redrawWrapper","createElement","className","CSS","PARENT","insertBefore","removeChild","canvasElem","canvasWrapper","CANVAS_WRAPPER","appendChild","canvasLeft","offsetLeft","fabric","_this","delayedSetup","setupImage","tmp","Image","addEventListener","src","image","maxWidth","width","maxHeight","height","scaleY","setDimensions","setScaleX","setScaleY","event","getBinder","renderAll","notify","setBackgroundImage","subscriptionId","sender","status","defaultCursor","clear","bind","offsetTop","getObjects","isEnabled","selection","forEachObject","o","selectable","TOOL","ARROW","DELETE","HORIZONTAL_LINE","PIXELATE","RECTANGLE","RESET","TEXT","DEFAULT_COLOR","DEFAULT_ACTIVE_COLOR","ACTIVE_BUTTON","DISABLED_BUTTON","BUTTON","TOOLBAR","EventAggregator","subscriptionsByTopic","onNotifyFn","_invokationScope","subscriber","invokationScope","_subscriber","j","splice","payload","s2","undefined","apply","addClasses","btnObj","classes","allClasses","forEach","clazz","classList","add","ControlsDispatcher","activeTool","notifyActive","manageKeys","e","keyCode","domParent","mainOptions","container","toolbarClass","toolbarFirst","firstChild","btn","innerHTML","label","onclick","btnActiveCss","buttonActiveClass","btnDisabledCss","buttonDisabledClass","currTool","remove"],"mappings":"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","file":"redraw.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"chartpen\"] = factory();\n\telse\n\t\troot[\"chartpen\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap eec79dcf89b8eb1c88c3\n **/","import Browser from './browser-api.js';\nimport Canvas from './canvas-wrapper.js';\nimport EventAggregator from './event-aggregator.js';\nimport ControlsDispatcher from './controls/controls-dispatcher.js';\n\n/**\n * Namespace-root, that will be set to window-Object.\n * @access private\n */\nvar redrawNs = {\n  tools: {}\n};\n\n/**\n * Makes a blob from eg base64-string.\n * @access private\n * @param data {string} encodedData - to encode\n * @returns {Blob} results\n */\nfunction dataURItoBlob(encodedData) {\n  var decodedData = atob(encodedData.split(',')[1]);\n  var array = []; // 8-bit unsigned array\n  for (var i = 0; i < decodedData.length; i++) {\n    array.push(decodedData.charCodeAt(i));\n  }\n\n  return new Blob([new Uint8Array(array)], {\n    type: 'image/png'\n  });\n}\n\n/**\n * If the user has defined the options.tools, then use this to\n * extract the sepcified subset from allTools.\n * @access private\n * @param {Object[]} allTools - should be tools to pick from.\n * @param {Object} options - with or without property tools.\n * @returns {Object} containing all or the selected tools.\n */\nfunction getToolsFromUserSettings(allTools, options) {\n\n  if (options && options.tools) {\n    var definedTools = {};\n    for (let t in options.tools) {\n      let toolName = options.tools[t];\n      definedTools[toolName] = allTools[toolName];\n    }\n\n    return definedTools;\n  } else {\n    return allTools;\n  }\n}\n\n/**\n * Defines the options-properties allowed to infect all tools-settings.\n * @access private\n */\nvar globalOverrides = ['color', 'activeColor'];\n\n/**\n * Figures out which options should be applied for a particular toolName.\n * @access private\n * @param {Object} allProps - already defined options, that shold not be lost, but perhaps\n * replaced if defined in precedenceProps or globalOptions.\n * @param {Object} precedenceProps - that may have a property named toolName, that will\n * replace options from allProps.\n * @param {Object} globalOptions - top-level options that will overwrite allProp but not precedenceProps\n * @param {string} toolName - name of the tool, which options is processed\n * @returns {Object} with tool applies options\n */\nfunction overwriteProps(allProps, precedenceProps, globalOptions, toolName) {\n  var results = {};\n\n  for (var p in allProps[toolName].options) {\n    if (allProps[toolName].options.hasOwnProperty(p)) {\n      if (precedenceProps[toolName] && precedenceProps[toolName] &&\n          precedenceProps[toolName].hasOwnProperty(p)) {\n        results[p] = precedenceProps[toolName][p];\n      } else if (globalOverrides.indexOf(p) > -1 &&\n          globalOptions.hasOwnProperty(p)) {\n        results[p] = globalOptions[p];\n      } else {\n        results[p] = allProps[toolName].options[p];\n      }\n    }\n  }\n\n  return results;\n}\n\n/**\n * Main module, and the only public api for usage.\n * @module redraw\n */\nclass Redraw {\n  /**\n   * Redraw constructor. Bootstraps the canvas and tools.\n   * @constructor\n   * @param {Object} imgElement - The dom element that holds the image.\n   * @param {Object} options - Options.\n   */\n  constructor(imgElement, options) {\n    this.events = new EventAggregator();\n    options = options || {};\n    this._canvas = new Canvas(imgElement, this.events, options); // Needs defactor\n\n    if (options.jsonContent) {\n      this._canvas.loadFromJSON(options.jsonContent);\n    }\n\n    this.controls = this.initializeTools(this.events, options);\n  }\n  /**\n   * Get the png-representation of the canvas.\n   * @access public\n   * @returns {string} with base64 encoded png.\n   */\n  getDataUrlForExport() {\n    this._canvas.canvas.deactivateAllWithDispatch();\n    return this._canvas.canvas.toDataURL({\n      format: 'png',\n      multiplier: 1 / this._canvas.scale\n    });\n  }\n\n  /**\n   * Get the base64-encoded png-representation of the canvas.\n   * @access public\n   * @returns {string} with base64 encoded png.\n   */\n  toBase64URL() {\n    return this.getDataUrlForExport();\n  }\n\n  /**\n   * Get the binary png-representation of the canvas.\n   * @access public\n   * @returns {Blob} with canvas as png.\n   */\n  toDataBlob() {\n    return dataURItoBlob(this.getDataUrlForExport());\n  }\n\n  /**\n   * Get the json-representation of the canvas.\n   * @access public\n   * @param {boolean} includeImage - true if background-image should be included in the json.\n   * @returns {string} with json.\n   */\n  toJson(includeImage) {\n    this.controls.cancelActiveTool();\n    var jsObj = this._canvas.canvas.toObject(['lockMovementX', 'lockMovementY',\n      'lockRotation', 'lockScalingX', 'lockScalingY', 'lockUniScaling',\n      'hasControls', 'hasRotatingPoint', 'selectable', 'fill', 'padding'\n    ]);\n\n    if (!includeImage) {\n      delete jsObj.backgroundImage;\n    }\n\n    return JSON.stringify(jsObj);\n  }\n\n  /**\n   * Resets image and loads content from provided json.\n   * @access public\n   * @param {string} jsonRepresentation - to provide as current state of the canvas.\n   */\n  fromJson(jsonRepresentation) {\n    this._canvas.loadFromJSON(jsonRepresentation);\n  }\n\n  /**\n   * Tells whether or not any objects are present in the canvas, i.e. arrows, rectangles other than the image itself.\n   * @access public\n   * @returns {boolean} true if there are obejcts, i.e.\n   */\n  isEmpty() {\n    return (this._canvas.getAllObjects()\n      .length === 0);\n  }\n\n  isDirty() {\n    return true;\n  }\n\n  /**\n   * Returns the canvas representation, as is from Fabric.js\n   * @access public\n   * @returns {Object} canvas, see http://fabricjs.com/.\n   */\n  getCanvas() {\n    return this._canvas.canvas;\n  }\n\n  on(topic, callbackFn, subscriberId, scope) {\n    this.events.subscribeTo(topic, 'cx-' + subscriberId, callbackFn, scope);\n  }\n\n  off(topic, subscriberId) {\n    this.events.unsubscribeTo(topic, 'cx-' + subscriberId);\n  }\n\n  /**\n   * Initializes all selected tools.\n   * @param {EventAggregator} events - used for all mediated communications.\n   * @param {Object} options - settings for all tools.\n   */\n  initializeTools(events, options) {\n    var localToolSettings = {};\n    options.toolSettings = options.toolSettings || {};\n    var toolsInUse = getToolsFromUserSettings(redrawNs.tools, options);\n\n    for (var toolName in toolsInUse) {\n      let passedProps = overwriteProps(redrawNs.tools, options.toolSettings, options, toolName);\n\n      redrawNs.tools[toolName].options = passedProps;\n\n      new redrawNs.tools[toolName].toolFn(this._canvas, events, passedProps);\n    }\n\n    var controls = new ControlsDispatcher(events, options);\n    controls.setupTools(toolsInUse, this._canvas.canvasContainer, options);\n    return controls;\n  }\n}\n\nredrawNs.Annotation = Redraw;\n/**\n * Used by tools to register themselves to be available for usage.\n * @access public\n * @param {string} _name - name of tool.\n * @param {function(canvas: CanvasWrapper, events: EventAggregator, passedProps: Object)} _toolFn - callback function, invoked upon initialization of the tools.\n * @param {Object} _options - options, to be used as default ones.\n */\nredrawNs.registerTool = function (_name, _toolFn, _options) {\n  redrawNs.tools[_name] = {\n    address: _name,\n    toolFn: _toolFn,\n    options: _options\n  };\n\n  // buttonClass is an attribute that applies to all tools\n  redrawNs.tools[_name].options.buttonClass = redrawNs.tools[_name].options.buttonClass || Â '';\n};\n\n(new Browser())\n.appendToWindow('redraw', redrawNs);\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/redraw.js\n **/","var isBrowser = typeof window !== 'undefined';\n\n/**\n * Facade of the browser apis. The main purpose id to facilitate testing.\n */\nexport default class Browser {\n  /**\n   * Contructor that determines if there is a browser present.\n   * @constructor\n   */\n  constructor() {\n    this.document = isBrowser ? document : {};\n    this.window = isBrowser ? window : {};\n  }\n\n  /**\n   * Appends property to the browser window object.\n   * @param {string} attributeName - Name of the property to create/assign.\n   * @param {Object} obj - value to set.\n   */\n  appendToWindow(attributeName, obj) {\n\n    if (isBrowser) {\n      window[attributeName] = obj;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Use to retrieve property from the browser window object.\n   * @param {string} attributeName - Name of the property to create/assign.\n   * @returns {Object} obj - retrieved value, or mock if not browser.\n   */\n  getFromWindow(attributeName) {\n    if (window) {\n      return window[attributeName];\n    }\n\n    return {\n      getFromWindow: function () {},\n      tools: []\n    };\n  }\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/browser-api.js\n **/","import CONST from './canvas-const.js';\n\n/**\n * Gets the scroll position of a dom element.\n * @access private\n * @param {Object} elem - target element.\n */\nfunction scrollPosition(elem) {\n  var left = 0;\n  var top = 0;\n\n  do {\n    left += elem.scrollLeft;\n    top += elem.scrollTop;\n  } while (elem = elem.offsetParent);\n\n  return [left, top];\n}\n\n/**\n * Canvas object that facilitates\n */\nexport default class Canvas {\n  /**\n   * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n   * @constructor\n   * @param {Object} imgElement - dom element that will be replaced and\n   * used as background for canvas.\n   * @param {EventAggregator} eventAggregator - Event mediator.\n   * @param {Object} options - parameters used to setup looks and all tools preferences.\n   */\n  constructor(imgElement, eventAggregator, options) {\n    this.options = options;\n    this.eventAggregator = eventAggregator;\n    var parent = imgElement.parentNode;\n    var redrawWrapper = document.createElement('div');\n    redrawWrapper.className = CONST.CSS.PARENT;\n    this.scale = 1;\n    parent.insertBefore(redrawWrapper, imgElement);\n    parent.removeChild(imgElement);\n\n    var canvasElem = document.createElement('canvas');\n    let canvasWrapper = document.createElement('div');\n    canvasWrapper.className = CONST.CSS.CANVAS_WRAPPER;\n    canvasWrapper.appendChild(canvasElem);\n    redrawWrapper.appendChild(canvasWrapper);\n\n    this.canvasElem = canvasElem;\n\n    this.canvasContainer = redrawWrapper;\n    this.canvasLeft = canvasElem.offsetLeft;\n    this.canvas = new fabric.Canvas(canvasElem);\n    this.imgElement = imgElement;\n\n    /* wait until the image is surely loaded to make the setup */\n    let _this = this;\n    let delayedSetup = function () {\n      _this.setupImage();\n    };\n\n    var tmp = new Image();\n    tmp.addEventListener('load', delayedSetup, false);\n    tmp.src = this.imgElement.src;\n  }\n\n  setupImage() {\n    this.image = new fabric.Image(this.imgElement);\n    if (this.options.maxWidth && this.options.maxWidth < this.image.width) {\n      this.scale = this.options.maxWidth / this.image.width;\n    }\n\n    if (this.options.maxHeight && this.options.maxHeight < this.image.height) {\n      let scaleY = this.options.maxHeight / this.image.height;\n      if (this.scale > scaleY) {\n        this.scale = scaleY;\n      }\n    }\n\n    this.width = this.scale * this.imgElement.width;\n    this.height = this.scale * this.imgElement.height;\n\n    this.canvas.setDimensions({\n      width: this.width,\n      height: this.height\n    });\n\n    this.image.setScaleX(this.scale);\n    this.image.setScaleY(this.scale);\n    var event = this.eventAggregator;\n\n    function getBinder(_canvas) {\n      return function () {\n        _canvas.renderAll();\n        event.notify('canvas-loaded', 'CANVAS');\n      };\n    }\n\n    this.canvas.setBackgroundImage(this.image, getBinder(this.canvas), {});\n\n    if (this.options.maxWidth && this.options.maxWidth < this.image.width) {\n      this.scale = this.options.maxWidth / this.image.width;\n    }\n\n    if (this.options.maxHeight && this.options.maxHeight < this.image.height) {\n      let scaleY = this.options.maxHeight / this.image.height;\n      if (this.scale > scaleY) {\n        this.scale = scaleY;\n      }\n    }\n\n    this.eventAggregator.subscribeTo('TOOL_USAGE', 'toolbar',\n      function (subscriptionId, sender, status) {\n        if (status === 'active') {\n          this.canvas.defaultCursor = 'crosshair';\n        } else {\n          this.canvas.defaultCursor = 'default';\n        }\n      }, this);\n  }\n\n  loadFromJSON(jsonContent) {\n    this.canvas.clear();\n    this.canvas.loadFromJSON(jsonContent, this.canvas.renderAll.bind(this.canvas));\n  }\n\n  /**\n   * Gets the top position of the canvas dom element.\n   * @access public\n   * @returns {number} position in pixels?\n   */\n  getCanvasTop() {\n    return this.canvasContainer.offsetTop;\n  }\n\n  /**\n   * Gets the array of all objects of the canvas.\n   * @access public\n   * @returns {Array} with canvas object, or undefined if empty.\n   */\n  getAllObjects() {\n    return this.canvas.getObjects();\n  }\n\n  /**\n   * Set/unset whether or not it is possible to select objects of the canvas.\n   * @access pulic\n   * @param {boolean} isEnabled - true if selection is enabled, false otherwise.\n   */\n  enableSelection(isEnabled) {\n    this.canvas.selection = isEnabled; // Restore fabricjs selection-box\n    this.canvas.forEachObject(function (o) {\n      o.selectable = isEnabled;\n    });\n  }\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/canvas-wrapper.js\n **/","export default {\n  TOOL: {\n    ARROW: 'arrow',\n    DELETE: 'delete',\n    HORIZONTAL_LINE: 'horizontalLine',\n    PIXELATE: 'pixelate',\n    RECTANGLE: 'rectangle',\n    RESET: 'reset',\n    TEXT: 'text'\n  },\n  DEFAULT_COLOR: '#33e',\n  DEFAULT_ACTIVE_COLOR: '#55f',\n  CSS: {\n    ACTIVE_BUTTON: 'active',\n    DISABLED_BUTTON: 'disabled',\n    BUTTON: 'redraw-btn',\n    PARENT: 'redraw-parent',\n    TOOLBAR: 'redraw-toolbar',\n    CANVAS_WRAPPER: 'redraw-canvas'\n  }\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/canvas-const.js\n **/","/**\n * Mediator for events.\n */\nexport default class EventAggregator {\n  /**\n   * Contructor that initializes internal stuff.\n   * @constructor\n   */\n  constructor() {\n    this.subscriptionsByTopic = {};\n  }\n\n  /**\n   * Registers a subscriber for a specific event topic.\n   * @param {string} topic - name of the event type / topic.\n   * @param {string} subscriberId - id the subscriber, must be unique.\n   * @param {function(topic: string, sender: string, payload: Object)} onNotifyFn - callback\n   * invoked upon when upon notification.\n   * @param {Object} [_invokationScope] - scope to be used when invoking callback.\n   */\n  subscribeTo(topic, subscriberId, onNotifyFn, _invokationScope) {\n    if (!this.subscriptionsByTopic[topic]) {\n      this.subscriptionsByTopic[topic] = [];\n    }\n\n    this.subscriptionsByTopic[topic].push({\n      subscriber: subscriberId,\n      callbackFn: onNotifyFn,\n      invokationScope: _invokationScope\n    });\n  }\n\n  // ToDo needs test\n  /**\n   * Unregisters a subscriber from a specific event topic.\n   * @param {string} topic - name of the event type / topic.\n   * @param {string} _subscriber - id the unique subscriber.\n   */\n  unsubscribeTo(topic, _subscriber) {\n    for (var j in this.subscriptionsByTopic[topic]) {\n      if (this.subscriptionsByTopic[topic][j].subscriber === _subscriber) {\n        this.subscriptionsByTopic[topic].splice(j, 1);\n      }\n    }\n  }\n\n  /**\n   * Called to notify all subscribers of this topic\n   * @param {string} topic - name of the event type / topic.\n   * @param {string} sender - address of the sender.\n   * @param {Object} payload - any data to pass to the subscriber.\n   */\n  notify(topic, sender, payload) {\n    for (var s2 in this.subscriptionsByTopic[topic]) {\n      let scope = undefined;\n      if (this.subscriptionsByTopic[topic][s2].invokationScope) {\n        scope = this.subscriptionsByTopic[topic][s2].invokationScope;\n      }\n\n      this.subscriptionsByTopic[topic][s2].callbackFn.apply(scope, [topic, sender, payload]);\n    }\n  }\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/event-aggregator.js\n **/","import CONST from '../canvas-const.js';\n\n/**\n * Adds a class to the array of classes.\n * @private\n */\nfunction addClasses(btnObj, classes) {\n  if (!classes) return;\n  var allClasses = classes.split(' ');\n\n  allClasses.forEach((clazz) => {\n    btnObj.classList.add(clazz);\n  });\n}\n\n/**\n * Main manager for the toolbar.\n */\nexport default class ControlsDispatcher {\n  /**\n   * Controls contructor. Is provided with canvas-wrapper and options to initialize to toolbar.\n   * @constructor\n   * @param {EventAggregator} eventAggregator - Event mediator.\n   * @param {Object} options - from user.\n   */\n  constructor(eventAggregator, options) {\n    this.toolsInUse = {};\n    let activeTool;\n\n    function notifyActive(topic) {\n      return function () {\n        if (activeTool) {\n          eventAggregator.notify(activeTool, 'toolbar', 'toolbar-deactivate');\n        }\n\n        if (activeTool !== topic) {\n          activeTool = topic;\n          eventAggregator.notify(topic, 'toolbar', 'toolbar-click');\n        } else {\n          activeTool = undefined;\n        }\n      };\n    }\n\n    this.cancelActiveTool = function () {\n\n      if (activeTool) {\n        eventAggregator.notify(activeTool, 'toolbar', 'toolbar-deactivate');\n        activeTool = undefined;\n      }\n    };\n\n    var manageKeys = function (e) {\n      if (e.keyCode === 46 || e.keyCode === 27) {\n        eventAggregator.notify('keydown', 'toolbar', e.keyCode);\n      }\n    };\n\n    window.addEventListener('keydown', manageKeys, false);\n\n    this.setupTools = function (tools, domParent, mainOptions) {\n      var container = document.createElement('div');\n\n      addClasses(container, CONST.CSS.TOOLBAR);\n      addClasses(container, options.toolbarClass);\n\n      if (mainOptions.toolbarFirst === true) {\n        domParent.insertBefore(container, domParent.firstChild);\n      } else {\n        domParent.appendChild(container);\n      }\n\n      for (var toolName in tools) {\n        var btn = document.createElement('button');\n        btn.innerHTML = tools[toolName].options.label;\n\n        btn.classList.add(CONST.CSS.BUTTON);\n\n        addClasses(btn, mainOptions.buttonClass);\n        addClasses(btn, tools[toolName].options.buttonClass);\n\n        btn.onclick = notifyActive(tools[toolName].address);\n        this.toolsInUse[tools[toolName].address] = btn;\n        container.appendChild(btn);\n      }\n\n      var btnActiveCss = mainOptions.buttonActiveClass || CONST.CSS.ACTIVE_BUTTON;\n      var btnDisabledCss = mainOptions.buttonDisabledClass || CONST.CSS.DISABLED_BUTTON;\n\n      eventAggregator.subscribeTo('TOOL_USAGE', 'toolbar',\n        function (subscriptionId, sender, status) {\n          var currTool = this.toolsInUse[sender];\n\n          if (status !== 'active') {\n            if (sender === activeTool) {\n              activeTool = undefined;\n            }\n\n            currTool.classList.remove(btnActiveCss);\n          } else {\n            currTool.classList.add(btnActiveCss);\n          }\n        }, this);\n\n      eventAggregator.subscribeTo('tool-enabled', 'toolbar',\n        function (subscriptionId, sender, isEnabled) {\n          if (isEnabled) {\n            this.toolsInUse[sender].classList.remove(btnDisabledCss);\n          } else {\n            this.toolsInUse[sender].classList.add(btnDisabledCss);\n          }\n        }, this);\n    };\n  }\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/controls/controls-dispatcher.js\n **/"],"sourceRoot":""}